<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Trend Analysis Reports</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Zero-MD for rendering markdown on the fly -->
    <script type="module" src="https://cdn.jsdelivr.net/npm/zero-md@3?register"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Reddit Trend Analysis</h1>
            <p>Daily insights from Reddit discussions and viral trends.</p>
        </header>

        <main id="app">
            <div id="report-list" class="report-grid">
                <!-- Reports will be injected here via JS -->
            </div>
            
            <div id="report-viewer" class="hidden">
                <button id="back-btn">‚Üê Back to List</button>
                <zero-md id="markdown-viewer" src="">
                    <template>
                        <style>
                            :host { display: block; position: relative; contain: content; }
                            :host([hidden]) { display: none; }
                            /* Dark mode adjustments for markdown content */
                            .markdown-body {
                                color: #c9d1d9;
                                background-color: #0d1117; 
                                font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
                            }
                            .markdown-body h1, .markdown-body h2, .markdown-body h3 {
                                color: #58a6ff;
                                border-bottom-color: #30363d;
                            }
                            .markdown-body a { color: #58a6ff; }
                            .markdown-body pre { background-color: #161b22; }
                            .markdown-body code { background-color: rgba(110, 118, 129, 0.4); }
                        </style>
                    </template>
                </zero-md>
            </div>
        </main>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const reportList = document.getElementById('report-list');
            const reportViewer = document.getElementById('report-viewer');
            const markdownViewer = document.getElementById('markdown-viewer');
            const backBtn = document.getElementById('back-btn');

            // Fetch report list
            try {
                const response = await fetch('reports.json');
                if (!response.ok) throw new Error('Failed to load reports.json');
                const reports = await response.json();

                // Sort reports by date (descending)
                reports.sort((a, b) => new Date(b.date) - new Date(a.date));

                reports.forEach(report => {
                    const card = document.createElement('div');
                    card.className = 'report-card';
                    card.innerHTML = `
                        <h2>${report.date}</h2>
                        <p class="summary">${report.summary ? report.summary.substring(0, 150) + '...' : ''}</p>
                        <button class="view-btn">View Report</button>
                    `;
                    card.querySelector('.view-btn').addEventListener('click', () => {
                        showReport(report.filename);
                    });
                    reportList.appendChild(card);
                });
            } catch (error) {
                console.error(error);
                reportList.innerHTML = '<p class="error">Failed to load reports. Please run generate_index.py.</p>';
            }

            // View Report function
            function showReport(filename) {
                reportList.classList.add('hidden');
                reportViewer.classList.remove('hidden');
                markdownViewer.src = `reports/${filename}`;
            }

            // Back button
            backBtn.addEventListener('click', () => {
                reportViewer.classList.add('hidden');
                reportList.classList.remove('hidden');
                markdownViewer.src = '';
            });
        });
    </script>
</body>
</html>
