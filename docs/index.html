<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Trend Analysis Reports</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Zero-MD for rendering markdown on the fly -->
    <script type="module" src="https://cdn.jsdelivr.net/gh/zerodevx/zero-md@3/dist/zero-md.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöÄ Reddit Trend Analysis</h1>
            <p>Daily insights from Reddit discussions and viral trends.</p>
        </header>

        <main id="app">
            <div id="report-list" class="report-grid">
                <!-- Reports will be injected here via JS -->
            </div>
            
            <div id="report-viewer" class="hidden">
                <button id="back-btn">‚Üê Back to List</button>
                <zero-md id="markdown-viewer" src=""></zero-md>
            </div>
        </main>

        <footer>
            <p>Generated by Idea Crawler Agent</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const reportList = document.getElementById('report-list');
            const reportViewer = document.getElementById('report-viewer');
            const markdownViewer = document.getElementById('markdown-viewer');
            const backBtn = document.getElementById('back-btn');

            // Fetch report list
            try {
                const response = await fetch('reports.json');
                if (!response.ok) throw new Error('Failed to load reports.json');
                const reports = await response.json();

                // Sort reports by date (descending)
                reports.sort((a, b) => new Date(b.date) - new Date(a.date));

                reports.forEach(report => {
                    const card = document.createElement('div');
                    card.className = 'report-card';
                    card.innerHTML = `
                        <h2>${report.date}</h2>
                        <p>${report.title || 'Daily Trend Analysis'}</p>
                        <button class="view-btn">View Report</button>
                    `;
                    card.querySelector('.view-btn').addEventListener('click', () => {
                        showReport(report.filename);
                    });
                    reportList.appendChild(card);
                });
            } catch (error) {
                console.error(error);
                reportList.innerHTML = '<p class="error">Failed to load reports. Please run generate_index.py.</p>';
            }

            // View Report function
            function showReport(filename) {
                reportList.classList.add('hidden');
                reportViewer.classList.remove('hidden');
                markdownViewer.src = `reports/${filename}`;
            }

            // Back button
            backBtn.addEventListener('click', () => {
                reportViewer.classList.add('hidden');
                reportList.classList.remove('hidden');
                markdownViewer.src = '';
            });
        });
    </script>
</body>
</html>
