# StyleVault 엔지니어링 Q&A

> **관련 문서:** [아이디어 리포트](./ideas_ai_style_marketplace_2026-02-20.md) | [리뷰 기사](./stylevault_review_article.md)

SW 엔지니어와 시스템 아키텍트 간의 핑퐁 대화 형식으로, StyleVault의 기술적 실현 가능성을 검증합니다.

---

## Round 1: 저작권 체인 & 데이터 무결성

🧑‍💻 **엔지니어:** 리뷰 기사에서 "저작권 체인"이 핵심 가치라고 했는데, 구체적으로 어떻게 구현하는지 궁금합니다. 학습 데이터 23장 → LoRA 학습 → 이미지 생성 → 기업 사용까지의 전체 체인을 추적하려면 어떤 데이터 모델이 필요한가요?

🏗️ **아키텍트:** 저작권 체인은 **이벤트 소싱(Event Sourcing)** 패턴으로 구현합니다. 모든 행위가 불변(immutable) 이벤트로 기록됩니다.

```yaml
# Event Schema
events:
  - type: ARTIST_VERIFIED
    timestamp: "2026-01-15T10:00:00Z"
    data:
      artist_id: "art_12345"
      verification_method: ["portfolio_cross_check", "live_drawing"]
      platforms_linked: ["artstation", "pixiv"]
      
  - type: TRAINING_DATA_UPLOADED
    timestamp: "2026-01-16T09:00:00Z"
    data:
      artist_id: "art_12345"
      images: 23
      hashes: ["sha256:abc...", "sha256:def..."]  # 각 이미지의 해시
      copyright_declarations:
        all_original: true
        no_third_party_ip: true
      cross_validation:
        artstation_matches: 21  # 외부 플랫폼에서 확인된 수
        timestamp_verified: true
      
  - type: LORA_TRAINED
    timestamp: "2026-01-16T09:15:00Z"
    data:
      lora_id: "lora_67890"
      model_hash: "sha256:xyz..."
      training_data_event_id: "evt_002"  # 학습 데이터 이벤트로 역추적
      qa_report:
        style_fidelity: 94.2
        overfit_risk: 12.3
        copyright_conflict: false
        
  - type: LICENSE_PURCHASED
    timestamp: "2026-01-20T14:00:00Z"
    data:
      lora_id: "lora_67890"
      buyer_id: "biz_99999"
      tier: "studio"
      license_id: "lic_11111"
      
  - type: IMAGE_GENERATED
    timestamp: "2026-01-20T14:05:00Z"
    data:
      generation_id: "gen_22222"
      lora_id: "lora_67890"
      license_id: "lic_11111"
      prompt: "dark elf mage, casting spell"
      output_hash: "sha256:out..."
      certificate_embedded: true
```

이 이벤트 로그는 **append-only**로 어떤 이벤트도 삭제/수정 불가합니다. PostgreSQL의 append-only 테이블 + S3에 이벤트 아카이브를 저장합니다.

🧑‍💻 **엔지니어:** 이미지 해시만으로는 학습 데이터 원본성을 보장하기 어렵지 않나요? 작가가 다른 사람의 이미지를 자기 것이라고 업로드하면요?

🏗️ **아키텍트:** 세 가지 레이어로 검증합니다:

| 레이어 | 방법 | 정확도 |
|--------|------|--------|
| **L1: 플랫폼 교차검증** | Artstation/Pixiv 등에서 같은 이미지의 업로드 이력을 API로 확인. 업로드 시점에 해당 계정이 해당 이미지를 보유하고 있는지 체크 | 90%+ |
| **L2: 역이미지 검색** | Google Vision API + TinEye로 웹 전체에서 해당 이미지의 최초 출처 확인. 다른 사람의 갤러리에서 먼저 발견되면 플래그 | 85%+ |
| **L3: 스타일 클러스터링** | 업로드된 23장의 스타일 벡터를 CLIP으로 추출하여 일관성 검사. 한 작가의 작품이라면 벡터가 클러스터를 형성해야 함. 여러 작가의 작품을 섞으면 산포도가 높아져 경고 | 80%+ |

세 레이어를 모두 통과해야 학습이 시작됩니다. 의심스러운 경우 **수동 리뷰**로 에스컬레이션됩니다.

🧑‍💻 **엔지니어:** 이벤트 데이터 규모는 어느 정도로 예상하나요?

🏗️ **아키텍트:** 초기 가정:
- 작가 10,000명 × 평균 LoRA 3개 = 30,000 LoRA
- 기업 구매자 500개 × 월 평균 생성 1,000건 = 500,000건/월
- 이벤트 1건당 평균 2KB
- 월간 이벤트: ~600,000건 × 2KB = **~1.2GB/월**
- 연간: ~15GB

PostgreSQL로 충분히 처리 가능한 규모입니다. 연간 100만 작가/1만 기업 규모로 커져도 ~1.5TB/년 수준으로, 파티션과 아카이빙으로 관리 가능합니다.

---

## Round 2: LoRA 학습 & QA 파이프라인

🧑‍💻 **엔지니어:** 리뷰에서 "15분 만에 학습 완료"라고 했는데, 동시에 100명이 학습을 요청하면 어떻게 되나요? GPU 인프라 설계를 알려주세요.

🏗️ **아키텍트:** 학습 파이프라인은 **큐 기반 비동기 처리**로 설계합니다:

```
[학습 요청] → [SQS Queue] → [GPU Worker Pool] → [학습 완료] → [QA Pipeline] → [결과 알림]
```

**GPU 인프라:**

| 항목 | 사양 | 비용 |
|------|------|------|
| GPU 인스턴스 | AWS g5.xlarge (A10G 24GB) | $1.006/hr |
| LoRA 1개 학습 시간 | ~10~15분 (SDXL 기준) | ~$0.25/건 |
| 동시 학습 용량 | 기본 5대 (ScaleUp 최대 20대) | 피크 시 $20/hr |
| Auto Scaling 트리거 | 큐 대기 > 10건 시 ScaleUp | 평균 대기 시간 < 20분 목표 |

**비용 시뮬레이션 (월간):**
- 일간 평균 학습 요청: 50건
- 월간: 1,500건 × $0.25 = **$375/월 GPU 비용**
- 피크 (출시 초기): 200건/일 → $1,500/월

🧑‍💻 **엔지니어:** QA 파이프라인에서 "저작권 충돌 검사"가 특히 궁금합니다. 신규 LoRA의 출력이 기존 LoRA와 "너무 비슷한지" 어떻게 판단하나요?

🏗️ **아키텍트:** 3단계 파이프라인입니다:

```
[LoRA 학습 완료]
    │
    ▼
[Step 1: Reference Generation]
    - 표준 프롬프트 세트 20개로 이미지 생성
    - 프롬프트 예: "female warrior, standing, neutral background"
    │
    ▼
[Step 2: Embedding Comparison]
    - 생성된 20장의 CLIP 임베딩 추출
    - 기존 등록된 모든 LoRA의 레퍼런스 임베딩과 코사인 유사도 계산
    - 임계값: similarity > 0.92 → 경고 플래그
    │
    ▼
[Step 3: IP Character Check]
    - 생성물이 알려진 IP 캐릭터(마리오, 피카츄 등)와 유사한지
    - 사전 학습된 IP 감지 모델로 분류
    - 탐지 시 학습 데이터 리뷰로 에스컬레이션
```

임계값 0.92는 보수적인 수치로, 실제 다른 작가의 LoRA와 유사도가 0.92를 넘으면 "스타일이 사실상 동일"로 볼 수 있습니다. 이 경우 두 작가에게 알림을 보내고 수동 리뷰를 진행합니다.

🧑‍💻 **엔지니어:** 레퍼런스 임베딩 비교 시 LoRA가 10만 개가 되면 검색 속도가 문제 아닌가요?

🏗️ **아키텍트:** CLIP 임베딩은 768차원 벡터입니다. **Pinecone** 또는 **Milvus** 같은 벡터 DB를 사용하면 10만 벡터 × 20장 = 200만 벡터에서도 ANN(Approximate Nearest Neighbor) 검색이 **< 50ms**에 가능합니다. 월 비용도 $70~$150 수준입니다.

---

## Round 3: 라이선스 관리 & 로열티 정산

🧑‍💻 **엔지니어:** 리뷰에서 LoRA 블렌딩(작가 A + 작가 B 스타일 혼합) 시 두 작가 모두에게 로열티를 분배한다고 했는데, 기술적으로 어떻게 기여도를 산정하나요?

🏗️ **아키텍트:** LoRA 블렌딩의 기여도 산정은 두 가지 방식을 제공합니다:

**방식 1: 가중치 비율 기반 (기본)**
```python
# 블렌딩 시 사용자가 설정하는 가중치
blend_config = {
    "lora_a": {"id": "lora_001", "weight": 0.7},  # 캐릭터 스타일
    "lora_b": {"id": "lora_002", "weight": 0.3},  # 배경 스타일
}

# 로열티 분배
generation_fee = 0.05  # $0.05/생성
royalty_a = generation_fee * 0.7 * 0.85  # 가중치 × (1 - 수수료)
royalty_b = generation_fee * 0.3 * 0.85
platform_fee = generation_fee * 0.15
```

**방식 2: 영향도 분석 기반 (프리미엄)**
- 블렌딩 결과물을 각 원본 LoRA 개별 출력과 CLIP 유사도 비교
- 실제로 최종 이미지에 더 많은 영향을 준 LoRA에 더 높은 비율 할당
- 계산 비용이 높아 Studio 이상 티어에서만 제공

🧑‍💻 **엔지니어:** 월정액 구독인 경우는 어떻게 분배하나요? Studio 티어 $149/월을 내면 5,000건을 생성할 수 있는데, 실제 3,000건만 사용하면?

🏗️ **아키텍트:** **실사용량 비례 분배(Pro-rata)** 방식입니다:

```python
# 월간 정산 로직
monthly_subscription = 149.00
platform_share = 0.15  # 15%
creator_pool = monthly_subscription * (1 - platform_share)  # $126.65

# 해당 기업이 이번 달 사용한 LoRA별 생성 건수
usage = {
    "lora_001": 2000,  # 작가 A
    "lora_002": 800,   # 작가 B  
    "lora_003": 200,   # 작가 C
}
total_generations = sum(usage.values())  # 3,000

# 분배
payout_a = creator_pool * (2000 / 3000)  # $84.43
payout_b = creator_pool * (800 / 3000)   # $33.77
payout_c = creator_pool * (200 / 3000)   # $8.44
```

미사용 분(2,000건 미사용)의 수수료는 **플랫폼 리저브 풀**에 적립되어, 분기별로 전체 작가에게 보너스로 분배됩니다.

🧑‍💻 **엔지니어:** 정산 주기와 최소 지급액은?

🏗️ **아키텍트:** 
- **정산 주기:** 월 1회 (말일 마감, 익월 15일 지급)
- **최소 지급액:** $20 (미달 시 이월)
- **지급 수단:** PayPal, Stripe Connect, 계좌 이체
- **대시보드:** 실시간 누적 수입, 일별 사용 통계, 예상 정산액 표시

---

## Round 4: 보안 & 윤리 / 악용 방지

🧑‍💻 **엔지니어:** LoRA 자체가 유출되면? 구매자가 LoRA 파일을 다운로드 받아서 로컬에서 무제한 사용하거나 재배포하는 것을 어떻게 막나요?

🏗️ **아키텍트:** 핵심 원칙: **LoRA 파일 자체는 절대 사용자에게 전달하지 않습니다.**

```
[기존 플랫폼 (Civitai)]
사용자 → LoRA 파일 다운로드 → 로컬 실행 → 무제한 사용

[StyleVault]
사용자 → API 호출 → 서버에서 생성 → 이미지만 전달
                     ↑
              LoRA는 서버에만 존재
```

모든 생성은 **StyleVault 클라우드**에서 이루어집니다. 사용자는 API 또는 Unity/Unreal 플러그인으로 프롬프트를 보내고, 결과 이미지만 받습니다. LoRA 가중치 파일은 서버의 암호화된 스토리지에서만 로드됩니다.

🧑‍💻 **엔지니어:** 그러면 오프라인 환경이나 로컬 처리를 선호하는 대형 스튜디오는 사용이 어렵지 않나요?

🏗️ **아키텍트:** Enterprise 티어에서 **On-Premise 배포** 옵션을 제공합니다:

| 배포 모델 | 대상 | LoRA 파일 위치 | 사용 추적 |
|-----------|------|---------------|-----------|
| Cloud API | Indie ~ Studio | StyleVault 서버 | 실시간 API 로그 |
| Hybrid | Mid-Studio | 고객 VPC 내 암호화 | 에이전트 기반 리포팅 |
| On-Premise | Enterprise | 고객 서버 (HSM 보호) | 월간 사용 감사 리포트 |

On-Premise의 경우 **HSM(Hardware Security Module)**에 LoRA 가중치를 저장하고, 추출이 물리적으로 불가능하게 합니다. 사용량은 에이전트가 월간 리포트를 StyleVault 서버에 전송합니다. 리포트 미전송 시 라이선스가 자동 정지됩니다.

🧑‍💻 **엔지니어:** NSFW 콘텐츠 생성 요청은 어떻게 처리하나요?

🏗️ **아키텍트:** 세 가지 레이어:

1. **작가 설정:** 각 작가가 LoRA 등록 시 "NSFW 생성 허용/불허" 설정. 불허 시 해당 LoRA로 NSFW 프롬프트 자체가 차단됨.
2. **프롬프트 필터:** NSFW 키워드 + 의미론적 분류기(BERT 기반)로 프롬프트 사전 필터링.
3. **출력 검사:** 생성된 이미지에 대해 NSFW 분류기(NudeNet 등) 실행. Score > 0.85 시 전달 차단.

작가가 NSFW를 허용한 경우에도, 구매 기업의 약관과 각국 법률에 따라 추가 필터가 적용됩니다.

---

## Round 5: 비용 & 인프라 / 손익분기

🧑‍💻 **엔지니어:** 전체 서비스의 월간 인프라 비용과 손익분기점을 계산해주세요. 초기 1년 기준으로요.

🏗️ **아키텍트:** 시나리오: 작가 1,000명, 기업 구매자 50개, 일간 생성 5,000건

**월간 인프라 비용:**

| 항목 | 상세 | 월 비용 |
|------|------|---------|
| **GPU (생성)** | g5.xlarge × 3대 (24/7) + 스팟 2대 (피크) | $2,800 |
| **GPU (학습)** | g5.xlarge × 스팟 (큐 기반) | $400 |
| **컴퓨팅 (API/웹)** | EC2 t3.xlarge × 3대 | $450 |
| **DB** | RDS PostgreSQL (db.r6g.large) | $350 |
| **벡터 DB** | Pinecone Starter | $70 |
| **스토리지** | S3 (이벤트 로그 + 이미지 캐시) | $200 |
| **CDN** | CloudFront | $150 |
| **기타** | 모니터링, 로깅, 이메일 등 | $200 |
| **합계** | | **$4,620/월** |

**월간 수익 (보수적):**

| 수익원 | 계산 | 월 수익 |
|--------|------|---------|
| 기업 구독 | Indie 30개 × $49 + Studio 15개 × $149 + Exclusive 5개 × $2,000 | $13,705 |
| 거래 수수료 | 작가 직접 판매 $5,000 × 15% | $750 |
| 학습 서비스 | LoRA 학습 50건 × $5 | $250 |
| **합계** | | **$14,705/월** |

**월간 지출 (인프라 + 운영):**

| 항목 | 월 비용 |
|------|---------|
| 인프라 | $4,620 |
| 인건비 (5인 초기 팀) | $35,000 |
| 작가 정산 | $10,500 |
| 마케팅 | $3,000 |
| **합계** | **$53,120/월** |

🧑‍💻 **엔지니어:** 월 매출 $14,705 vs 지출 $53,120이면 초기에 상당한 적자인데요. 언제 BEP를 달성하나요?

🏗️ **아키텍트:** 성장 시나리오 기반 BEP 분석:

```
Month  1:  작가    200 | 기업   10 | 매출   $3,000 | 적자 -$50,120
Month  3:  작가    500 | 기업   30 | 매출   $8,500 | 적자 -$44,620
Month  6:  작가  1,000 | 기업   50 | 매출  $14,705 | 적자 -$38,415
Month  9:  작가  2,500 | 기업  100 | 매출  $30,000 | 적자 -$28,120
Month 12: 작가  5,000 | 기업  200 | 매출  $58,000 | 적자  -$5,120
Month 14: 작가  7,000 | 기업  280 | 매출  $75,000 | BEP 달성 ✅
Month 18: 작가 10,000 | 기업  500 | 매출 $130,000 | 흑자  +$55,000
```

**BEP 핵심 조건:**
- Exclusive 계약 5건 이상 유지 (고단가 수익 안정)
- 기업 구독 이탈률 < 5%/월
- 초기 시드 펀딩 **$600K~$800K** 필요 (14개월 런웨이)

🧑‍💻 **엔지니어:** 스케일업 시 GPU 비용이 선형으로 증가하면 마진이 나빠지지 않나요?

🏗️ **아키텍트:** 두 가지 전략으로 GPU 효율을 높입니다:

1. **캐싱 레이어:** 같은 LoRA + 유사 프롬프트 조합의 결과를 캐시. 게임 개발에서는 "같은 캐릭터, 살짝 다른 포즈" 요청이 반복되므로 **캐시 히트율 30~40%** 예상.
2. **배치 생성:** 실시간이 아닌 "벌크 생성" 모드에서는 요청을 모아 배치 처리. GPU 활용률 65% → 85%로 개선.

이를 통해 생성 건당 비용을 $0.04 → $0.025로 낮출 수 있습니다.

---

## Round 6: 기술 스택 총괄

🧑‍💻 **엔지니어:** 최종적으로 전체 아키텍처 다이어그램과 기술 스택을 정리해주세요.

🏗️ **아키텍트:**

```
                         ┌─────────────────┐
                         │   클라이언트     │
                         │ Web / Unity /   │
                         │ Unreal Plugin   │
                         └────────┬────────┘
                                  │ HTTPS / WebSocket
                                  ▼
                    ┌─────────────────────────────┐
                    │         API Gateway          │
                    │     (AWS API Gateway)        │
                    │    Rate Limiting / Auth      │
                    └─────────────┬───────────────┘
                                  │
              ┌───────────────────┼───────────────────┐
              ▼                   ▼                   ▼
    ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
    │   Auth Service   │ │  Asset Service   │ │  License Service │
    │   (Cognito +     │ │  (Generation +   │ │  (계약/정산/     │
    │    Portfolio     │ │   QA Pipeline)   │ │   사용량 추적)   │
    │    Verification) │ │                  │ │                  │
    └────────┬────────┘ └────────┬────────┘ └────────┬────────┘
             │                   │                    │
             ▼                   ▼                    ▼
    ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
    │  PostgreSQL      │ │  GPU Cluster     │ │  PostgreSQL      │
    │  (유저/인증)     │ │  (g5.xlarge)     │ │  (이벤트 로그)   │
    └─────────────────┘ │  + SQS Queue     │ └─────────────────┘
                        └────────┬────────┘
                                 │
                    ┌────────────┼────────────┐
                    ▼            ▼            ▼
           ┌──────────┐  ┌──────────┐  ┌──────────┐
           │ S3        │  │ Pinecone │  │ Redis    │
           │ (이미지/  │  │ (벡터DB) │  │ (캐시)   │
           │  모델스토│  │          │  │          │
           │  리지)    │  │          │  │          │
           └──────────┘  └──────────┘  └──────────┘
```

**기술 스택 표:**

| 레이어 | 기술 | 선택 이유 |
|--------|------|-----------|
| **프론트엔드** | Next.js + TypeScript | SSR/SSG으로 SEO 최적화, React 생태계 |
| **모바일** | React Native (향후) | 코드 재사용, 알림/대시보드 위주 |
| **게임 플러그인** | C# (Unity) / C++ (Unreal) | 네이티브 성능, 엔진 마켓플레이스 배포 |
| **API** | FastAPI (Python) | AI/ML 라이브러리 호환, 비동기 지원 |
| **AI 엔진** | ComfyUI (서버 모드) | LoRA 로딩/블렌딩 유연성, 커스텀 노드 |
| **AI 모델** | SDXL / Flux (베이스) | 산업 표준, LoRA 호환성 검증됨 |
| **DB** | PostgreSQL 16 | ACID, JSON 지원, 이벤트 소싱에 적합 |
| **벡터 DB** | Pinecone | 관리형, ANN 검색 < 50ms |
| **캐시** | Redis Cluster | 캐싱 + 세션 + 큐 |
| **메시지 큐** | AWS SQS | GPU 학습/생성 작업 큐 |
| **스토리지** | AWS S3 + CloudFront | 이미지/모델 저장 + CDN |
| **인증** | AWS Cognito + OAuth2 | 소셜 로그인 + JWT |
| **결제** | Stripe Connect | 다국가 정산, 마켓플레이스 모드 |
| **모니터링** | Datadog | APM + 로그 + 인프라 통합 |
| **CI/CD** | GitHub Actions + ArgoCD | GitOps 기반 배포 |
| **인프라** | AWS (EKS + Terraform) | 컨테이너 오케스트레이션, IaC |

**핵심 설계 원칙:**
1. **이벤트 소싱 우선** — 모든 행위가 이벤트로 기록되어 법적 증거력 확보
2. **LoRA 격리** — LoRA 가중치 파일은 서버 외부로 절대 노출되지 않음
3. **GPU 효율** — 캐싱 + 배치 + 스팟 인스턴스로 비용 최적화
4. **마이크로서비스** — Auth/Asset/License 독립 스케일링
5. **글로벌 대응** — EU AI Act 준수, 다국가 결제/정산, GDPR 호환
