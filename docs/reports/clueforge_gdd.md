# ClueForge — Game Design Document (GDD)

> **문서 버전:** v1.0  
> **작성일:** 2026-02-18  
> **관련 문서:**  
> - [시나리오: 로즈힐 장원](./clueforge_scenario_rosehill.md)  
> - [캐릭터 바이블](./clueforge_character_bible.md)  
> - [레벨 디자인 & 밸런싱](./clueforge_level_design.md)  
> - [엔지니어링 Q&A](./clueforge_engineering_qa.md)  
> - [리뷰 기사](./clueforge_review_article.md)

---

## 1. 제품 비전

### 1.1 한 줄 정의
> **"AI가 만든 미스터리, 수학이 보장하는 공정함 — 매번 새로운 사건을 풀어내는 프로시저럴 추리 로그라이크"**

### 1.2 핵심 차별점

| 기존 솔루션 | ClueForge |
|-----------|-----------|
| LLM이 단서를 즉석 생성 → 모순·환각 빈발 | SMT 솔버가 논리 구조를 먼저 생성 → LLM은 서사만 담당 |
| 고정된 스크립트 → 1~2회 플레이로 소진 | 프로시저럴 생성 → 무한 리플레이 |
| 선택지 기반 대화 → 작위적 느낌 | 자유 텍스트 심문 + 감정 추적 → 탐정 롤플레이 |
| AI 게임 = 비용 블랙홀 | 사건당 ~$0.016 → 프리미엄 모델로 흑자 구조 |

### 1.3 타겟 유저

| 페르소나 | 설명 | 비율 |
|---------|------|:----:|
| **추리 덕후 (核心層)** | Obra Dinn, 역전재판, 단간론파 팬. 공정한 추리에 집착. "AI가 말 바꾸면 안 됨" | 40% |
| **로그라이크 팬** | Slay the Spire, Hades 류. 매 회차 새로운 경험 + 메타 진행을 원함 | 25% |
| **스토리 게이머** | 비주얼 노벨, 인터랙티브 픽션 팬. NPC와의 대화에서 몰입 | 20% |
| **AI 얼리어답터** | 새 기술 체험을 즐기는 유저. AI Dungeon 경험자 | 15% |

---

## 2. 핵심 루프

```
┌────────────┐
│  사건 수임   │ ◀──────────────────────────────────┐
│  (New Case)  │                                     │
└──────┬─────┘                                     │
       ▼                                           │
┌─────────────────┐                                │
│  현장 조사        │                                │
│  (장소 탐색/수색)  │ ←──┐                           │
└──────┬──────────┘    │                           │
       ▼               │                           │
┌─────────────────┐    │  새로운 장소/                │
│  NPC 심문         │    │  단서 발견 시               │
│  (자유 텍스트)     │ ───┘                           │
└──────┬──────────┘                                │
       ▼                                           │
┌─────────────────┐    ┌──────────────────┐        │
│  증거 보드        │    │  가설 수립/검증    │        │
│  (단서 연결)      │ ──▶│  (정합성 %)       │        │
└──────┬──────────┘    └──────┬───────────┘        │
       │                      │                     │
       │  정합성 90%↑          │ 정합성 부족           │
       ▼                      └──▶ 추가 조사 ───────┘
┌─────────────────┐                                 
│  고발 & 해설      │                                 
│  (확신 고발)      │                                 
└──────┬──────────┘                                 
       ▼                                           
┌─────────────────┐                                 
│  보상 & 메타 진행  │ ──▶ 새 사건 생성 ──────────────┘
│  (XP, 스킬 언락)  │
└─────────────────┘
```

### 2.1 세션 설계

| 항목 | 목표 |
|------|------|
| 1세션 길이 | 20~45분 (난이도별 차등) |
| 이상적 이용 빈도 | 주 3~5회, 일 1~2건 |
| 세션 저장 | 사건 중간 저장 가능 (모바일 대응) |
| 총 클리어 시간 | 없음 (무한 생성) |

---

## 3. 코어 시스템

### 3.1 미스터리 생성 엔진 (Mystery Generator)

ClueForge의 핵심 엔진. **Constraint-First Generation** 파이프라인으로 매 사건을 생성한다.

#### 3.1.1 생성 파이프라인

```
Phase A: Template Selection
  → setting, crime_type, motive 슬롯 랜덤 조합
  → 플레이 히스토리 블랙리스트 적용

Phase B: SMT Skeleton (Z3)
  → 범인/동기/기회/수단 논리 구조 생성
  → 단서 세트 & 해결 경로(solution path) 도출
  → 레드 헤링 삽입
  → 유일 해 보장 (unique solution constraint)

Phase C: Narrative Flesh (LLM)
  → NPC 프로필, 장소 묘사, 단서 서사화
  → 대화 페르소나 + 비밀 설정

Phase D: Validation
  → LLM 출력이 SMT 뼈대 위반 여부 체크
  → 위반 시 해당 요소만 재생성
```

#### 3.1.2 사건 정의 스키마

```yaml
case:
  id: "case_20260218_001"
  setting: "manor_house"
  crime_type: "murder_poison"
  difficulty: "hard"
  
  victim:
    name: "에밀리아 블랙우드"
    age: 67
    cause_of_death: "디기탈리스 중독"
    discovery: "정원에서 의식불명 발견"
  
  suspects: # 6명
    - id: "npc_01"
      name: "레오나드 블랙우드"
      relation: "장남"
      has_motive: true   # 유산
      has_opportunity: false  # 알리바이 있음
      has_means: false
      is_culprit: false
    # ... (6명)
  
  clues: # 10개
    - id: "clue_01"
      type: "forensic"
      description: "와인잔 잔여물 — 식물성 독소 검출"
      location: "kitchen"
      eliminates: ["npc_01", "npc_02"]  # 이 단서로 배제 가능한 용의자
      is_red_herring: false
    # ...
  
  solution_path: # SMT 솔버가 보장하는 추론 경로
    step_1: "clue_01 ∧ clue_03 → eliminate npc_01, npc_02"
    step_2: "clue_05 ∧ clue_07 → eliminate npc_04, npc_06"
    step_3: "clue_08 → confirm npc_03 (Victoria)"
  
  red_herrings: ["clue_02", "clue_09"]
```

### 3.2 NPC 심문 시스템 (Interrogation Engine)

#### 3.2.1 대화 흐름

```
유저 입력 (자유 텍스트)
    │
    ▼
┌──────────────────┐
│  Input Filter     │ → 부적절 입력 차단
└────────┬─────────┘
         ▼
┌──────────────────┐
│  Entity Resolver  │ → 질문에서 NPC/오브젝트/장소 참조 추출
└────────┬─────────┘
         ▼
┌──────────────────┐
│  Context Builder  │ → 현재 NPC 페르소나 + 관련 지식 + 감정 조합
└────────┬─────────┘
         ▼
┌──────────────────┐
│  LLM Generation   │ → 응답 생성 (캐릭터 유지)
└────────┬─────────┘
         ▼
┌──────────────────┐
│  Slip Detector    │ → 실언 이벤트 자동 감지 & 단서 등록
└────────┬─────────┘
         ▼
┌──────────────────┐
│  Emotion Updater  │ → NPC 감정 상태 업데이트
└────────┬─────────┘
         ▼
유저에게 응답 표시
```

#### 3.2.2 감정 시스템

```yaml
emotion_model:
  states: [calm, guarded, anxious, agitated, hostile, cooperative, relieved]
  
  transitions:
    calm → guarded:
      trigger: "사건 관련 직접 질문"
      threshold: 0.3
    
    guarded → anxious:
      trigger: "비밀에 근접한 질문"
      threshold: 0.5
    
    anxious → slip_event:
      trigger: "비밀 직접 언급 + 추가 압박"
      threshold: 0.7
      effect: "새 단서 자동 등록"
    
    any → hostile:
      trigger: "연속 3회 이상 공격적 질문"
      effect: "대화 거부 (변호사 요청)"
    
    guarded → cooperative:
      trigger: "공감적 접근 + 일상 대화"
      threshold: 0.4
      effect: "자발적 정보 제공 확률 증가"
  
  decay: "5턴 후 한 단계 calm 방향으로 자연 감소"
```

#### 3.2.3 실언(Slip) 이벤트 판정

```python
def check_slip_event(npc, question, case_state):
    """실언 이벤트 발생 조건 체크"""
    conditions = {
        "emotion_threshold": npc.emotion.anxiety >= 0.7,
        "secret_proximity": semantic_similarity(question, npc.secret) >= 0.6,
        "not_already_revealed": npc.secret not in case_state.revealed_secrets,
        "min_turns_elapsed": npc.dialogue_turns >= 3,  # 첫 3턴은 보호
    }
    
    if all(conditions.values()):
        # 실언 수준 결정 (부분 vs 전체)
        if npc.emotion.anxiety >= 0.9:
            return SlipEvent(type="full", reveals=npc.secret)
        else:
            return SlipEvent(type="partial", reveals=npc.secret_hint)
    
    return None
```

### 3.3 증거 보드 시스템 (Evidence Board)

#### 3.3.1 가설 정합성 계산

```
정합성(H) = (H가 설명하는 단서 수 / 총 유관 단서 수) 
            × (1 - 모순 페널티)

모순 페널티:
  - H가 가리키는 용의자에게 알리바이 있음 → -0.3
  - H에 사용된 수단이 용의자 접근 불가 → -0.3
  - 다른 단서가 H를 명시적으로 반증 → -0.5

예시:
  H = "클레어가 독살했다"
  - 연결된 단서: 약병, 유언장 (2/6 유관 단서) → 0.33
  - 모순: 클레어 알리바이 있음 → -0.3
  - 결과: 0.33 × (1 - 0.3) = 0.23 → 23% 표시
```

#### 3.3.2 확신 고발 조건

```yaml
confident_accusation:
  unlock_condition: "단일 가설의 정합성 >= 90%"
  
  scoring:
    correct_culprit: +100 XP
    correct_motive: +30 XP (보너스)
    correct_means: +30 XP (보너스)
    wrong_accusation: -20 XP, 사건 실패 (재도전 가능)
    
  early_solve_bonus:
    turns_under_15: "+50% XP"
    turns_under_25: "+25% XP"
    all_clues_found: "+20 XP (탐색왕 보너스)"
```

### 3.4 메타 진행 시스템 (Meta Progression)

```yaml
investigator_profile:
  level: 1~50
  xp_per_level: "100 × level^1.2"
  
  skill_tree:
    observation:  # 관찰 계열
      - lv1: "수색 시 발견 오브젝트 +1"
      - lv3: "레드 헤링에 '의심' 태그 표시 (30% 확률)"
      - lv5: "장소 진입 시 '흥미로운 점' 자동 하이라이트"
    
    psychology:  # 심리 계열
      - lv1: "NPC 감정 태그 세분화 (7단계 → 10단계)"
      - lv3: "실언 유도 확률 +15%"
      - lv5: "NPC 거짓말 탐지 힌트 (미세 표정 묘사)"
    
    forensics:  # 법의학 계열
      - lv1: "증거 분석 시간 50% 단축"
      - lv3: "독극물/흉기 자동 분류"
      - lv5: "범죄 현장 재구성 미니게임"
    
    deduction:  # 추론 계열
      - lv1: "가설 정합성 계산에 +5% 보정"
      - lv3: "역추론 힌트 (필요 증거 제안)"
      - lv5: "논리 체인 자동 시각화"
  
  unlockables:
    - "10건 해결: 하드보일드 UI 테마"
    - "25건 해결: 악몽 난이도 해금"
    - "50건 해결: 커스텀 시나리오 에디터 (베타)"
```

---

## 4. UI/UX 설계

### 4.1 핵심 화면 구성

```
┌─────────────────────────────────────────────────┐
│                    CLUEFORGE                     │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌────────┐│
│  │ 🗺 MAP  │ │💬 TALK  │ │📋 BOARD │ │⚙ MENU ││
│  └─────────┘ └─────────┘ └─────────┘ └────────┘│
├─────────────────────────────────────────────────┤
│                                                  │
│              [메인 콘텐츠 영역]                    │
│                                                  │
│  ┌─────────────────────────────────────────────┐│
│  │                                              ││
│  │    (MAP: 장소 맵 / TALK: 심문 대화 /         ││
│  │     BOARD: 증거 보드)                        ││
│  │                                              ││
│  └─────────────────────────────────────────────┘│
│                                                  │
├─────────────────────────────────────────────────┤
│  사건 #0023 | 난이도: ★★★ | 단서: 7/? | 시간: 25분│
└─────────────────────────────────────────────────┘
```

### 4.2 MAP 화면 (현장 조사)

```
┌─────────────────────────────────────────────────┐
│  🗺 로즈힐 장원                                  │
│                                                  │
│       ┌────────┐         ┌────────┐              │
│       │ 서재    │─────────│ 식당    │              │
│       │ 🔍×2   │         │ 🔍×3   │              │
│       └───┬────┘         └───┬────┘              │
│           │                   │                   │
│       ┌───┴────┐         ┌───┴────┐              │
│       │ 온실    │         │ 주방    │              │
│       │ 🔍×1   │         │ ✅완료  │              │
│       └───┬────┘         └────────┘              │
│           │                                      │
│       ┌───┴────┐         ┌────────┐              │
│       │ 정원    │─────────│ 차고    │              │
│       │ ⭐START │         │ 🔒잠김  │              │
│       └────────┘         └────────┘              │
│                                                  │
│  🔍 = 미발견 오브젝트 수  ✅ = 수색 완료           │
│  🔒 = 특정 단서 필요     ⭐ = 시작 위치            │
└─────────────────────────────────────────────────┘
```

### 4.3 TALK 화면 (NPC 심문)

```
┌─────────────────────────────────────────────────┐
│  💬 레오나드 블랙우드 (장남)        [경계 😐]     │
├─────────────────────────────────────────────────┤
│                                                  │
│  🧑‍💼 레오나드: "무슨 일로 오셨습니까?            │
│      경찰에 이미 다 말했는데."                     │
│                                                  │
│  🔎 나: "만찬에서 어머니 옆에 누가 앉았습니까?"    │
│                                                  │
│  🧑‍💼 레오나드: "내 아내 클레어가 앉았죠.          │
│      왜 그걸 궁금해하시는 겁니까?"                  │
│                                                  │
│  ⚡ [Slip 이벤트!] — 새 단서 발견                  │
│  🧑‍💼 레오나드: "...아, 사실 그날... 아닙니다.     │
│      잊어주세요."                                  │
│  📋 → 증거 보드에 "레오나드의 실언" 추가됨         │
│                                                  │
├─────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────── ─────┐│
│  │ 질문을 입력하세요...                    [📤] ││
│  └─────────────────────────────────────────────┘│
│  💡 힌트: 감정이 [불안]일 때 비밀 관련 질문을 하면 │
│     실언을 유도할 수 있습니다                      │
└─────────────────────────────────────────────────┘
```

### 4.4 BOARD 화면 (증거 보드)

```
┌─────────────────────────────────────────────────┐
│  📋 증거 보드                    [가설 수립 ▼]   │
├─────────────────────────────────────────────────┤
│                                                  │
│  ┌──────────┐     ┌──────────┐                   │
│  │ 🧪 약병   │─────│ 🌿 온실   │                   │
│  │ 디기탈리스│     │ 자주 방문 │                   │
│  │ [확인됨]  │     │ [미확인]  │                   │
│  └────┬─────┘     └──────────┘                   │
│       │                                          │
│       ├─────────────────────┐                    │
│       ▼                     ▼                    │
│  ┌──────────┐         ┌──────────┐               │
│  │ 📝 유언장 │         │ 🍷 와인잔 │               │
│  │ 변경 계획 │         │ 잔여물    │               │
│  │ [확인됨]  │         │ [분석중]  │               │
│  └──────────┘         └──────────┘               │
│                                                  │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│  💙 가설 A: "빅토리아가 유산을 위해 독살"  [72%]  │
│  💛 가설 B: "레오나드가 집사를 매수"       [45%]  │
│  🩶 가설 C: "집사의 단독 범행"            [23%]  │
│                                                  │
│  [🎯 확신 고발] (90% 이상 시 활성화)              │
└─────────────────────────────────────────────────┘
```

---

## 5. 수익 모델

### 5.1 가격 구조 (프리미엄 구매 + DLC)

| 항목 | 가격 | 포함 내용 |
|------|:----:|----------|
| **기본 게임** | $4.99 | 3개 세팅 (저택/유람선/대학), 모든 난이도, 무한 사건 생성 |
| **Noir Pack** | $1.99 | 1940년대 세팅, 흑백 UI, 하드보일드 톤 |
| **Sci-Fi Pack** | $1.99 | 우주/달 기지, CCTV 증거 시스템 |
| **Cozy Mystery** | $1.99 | 시골/제과점, 요리 미니게임 |
| **True Crime** | $2.99 | 실제 범죄 유형 기반, 법의학 도구 확장 |
| **완전판 번들** | $9.99 | 기본 + 전 DLC (30% 할인) |

### 5.2 추가 수익원

| 수익원 | 모델 | 예상 수익 기여 |
|--------|------|:------------:|
| 시즌 이벤트 DLC | 분기별 한정 테마 ($1.99) | 15% |
| 커스텀 시나리오 에디터 (유료 언락) | $2.99 일회성 | 10% |
| 프로 모드 (로컬 LLM + 오프라인) | $4.99 일회성 | 5% |

### 5.3 손익 분석 요약

```
유저당 수입: $4.33 (기본 + DLC 평균)
유저당 비용: $1.74/년 (LLM API + 인프라)
유저당 이익: $2.59 (마진 ~60%)
손익분기: 출시 첫 달 (구매 시점 흑자)

목표 매출 (1년):
  10,000 유저 × $4.33 = $43,300
  운영 비용: ~$17,400
  순이익: ~$25,900
```

---

## 6. 기술 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                    ClueForge Architecture                 │
│                                                          │
│  ┌────────────────────────────────────────────────────┐  │
│  │           Client Layer (Godot 4.x)                 │  │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────────────┐ │  │
│  │  │ MAP View │  │TALK View │  │ BOARD View       │ │  │
│  │  │ (장소맵) │  │(심문 UI) │  │ (증거보드 캔버스) │ │  │
│  │  └──────────┘  └──────────┘  └──────────────────┘ │  │
│  └──────────────────────┬─────────────────────────────┘  │
│                         │ REST API / WebSocket             │
│  ┌──────────────────────┴─────────────────────────────┐  │
│  │            Backend Layer (Python + FastAPI)          │  │
│  │                                                      │  │
│  │  ┌────────────┐  ┌────────────┐  ┌───────────────┐  │  │
│  │  │Mystery Gen.│  │NPC Engine  │  │Evidence Board │  │  │
│  │  │ Z3 + LLM   │  │ LLM Agent  │  │ Solver Logic  │  │  │
│  │  └────────────┘  └────────────┘  └───────────────┘  │  │
│  │                                                      │  │
│  │  ┌────────────┐  ┌────────────┐  ┌───────────────┐  │  │
│  │  │State Mgr   │  │Safety Layer│  │Analytics      │  │  │
│  │  │Redis+SQLite│  │Moderation  │  │PostHog        │  │  │
│  │  └────────────┘  └────────────┘  └───────────────┘  │  │
│  └──────────────────────┬─────────────────────────────┘  │
│                         │                                 │
│  ┌──────────┐  ┌────────┴───┐  ┌──────────────────────┐  │
│  │ LLM API  │  │ PostgreSQL │  │ Redis (Session)      │  │
│  │GPT-4o-mini│  │ (영구저장) │  │ (실시간 상태)         │  │
│  └──────────┘  └────────────┘  └──────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 6.1 핵심 기술 스택

| 영역 | 기술 | 선정 이유 |
|------|------|----------|
| 클라이언트 | Godot 4.x (GDScript) | 크로스플랫폼, 무료, 텍스트 UI 적합 |
| 백엔드 | Python 3.12 + FastAPI | Z3/LLM 생태계, async 지원 |
| 미스터리 엔진 | Z3 SMT Solver | 논리적 일관성 수학적 보장 |
| LLM | GPT-4o-mini (1순위) / Gemini Flash (2순위) | 비용-품질 밸런스 |
| NPC 프레임워크 | LangChain Agents | 체계적 프롬프트·메모리 관리 |
| 세션 저장 | Redis | 실시간 게임 상태 |
| 영구 저장 | PostgreSQL + SQLite (로컬) | 유저 프로필, 메타 진행 |
| 배포 | Docker + GCP Cloud Run | 자동 스케일링, 종량제 |
| 분석 | PostHog | 오픈소스, 사건 해결 패턴 분석 |
| CI/CD | GitHub Actions | 자동화 테스트·배포 |

---

## 7. 런칭 로드맵

### Phase 0: 프로토타입 (8주)
- Z3 + LLM 미스터리 생성 파이프라인 구현
- 터미널 기반 플레이 가능 데모
- NPC 심문 3명, 세팅 1개 (저택)
- **마일스톤:** 터미널에서 1건 완전 해결 가능

### Phase 1: Alpha (12주)
- Godot UI 구현 (MAP/TALK/BOARD 3개 뷰)
- NPC 6명, 세팅 3개, 증거 보드 캔버스
- 감정 시스템 + 실언 이벤트
- 메타 진행 시스템 (스킬 트리)
- **마일스톤:** 내부 플레이테스트 10건 해결

### Phase 2: Beta (8주)
- 6개 세팅 완성, DLC 1팩 (Noir)
- 밸런싱: 난이도별 해결률 목표 달성 확인
- 콘텐츠 필터 & 안전 시스템 완성
- 클로즈드 베타 50~100명
- **마일스톤:** 베타 유저 해결률 60~80%, NPS 40+

### Phase 3: 출시 (4주)
- Steam/iOS/Android 스토어 등록
- 마케팅: 추리 게임 커뮤니티, Reddit, 유튜버 키 배포
- 출시 후 1주 핫픽스 기간
- **마일스톤:** 출시 첫 달 1,000 판매

---

## 8. 핵심 리스크 & 대응

| 리스크 | 심각도 | 대응 전략 |
|--------|:------:|----------|
| NPC 대화 품질 장기 반복 | 🔴 | Big Five 페르소나 확대, 말투 풀 지속 추가, 유저 피드백 루프 |
| LLM API 비용 급등 | 🔴 | 멀티 프로바이더 전략 (GPT → Gemini → Ollama), 로컬 모드 |
| SMT 뼈대가 LLM 서사를 제약 | 🟡 | 제약 파라미터 튜닝, "영감" 슬롯 (LLM이 제안 → SMT 검증 루프) |
| 모바일 세션 시간 과다 | 🟡 | "미니 사건" 모드 (용의자 3명, 15분), 중간 저장 |
| 경쟁작 등장 (대형 스튜디오) | 🟡 | SMT 검증이라는 기술적 해자, 커뮤니티 기반 시나리오 에디터 |
| 콘텐츠 안전 사고 | 🟢 | 3겹 필터 + 모니터링 대시보드 + 신속 대응 프로세스 |

---

*다음 문서: [시나리오: 로즈힐 장원](./clueforge_scenario_rosehill.md) →*
